<html>
    <head>
        <title>ОТЧЕТ ЗА ДЕНЯ</title>
        <script src="/static/js/libs/angular.min.js"></script>
        <script src="/static/js/libs/angular-resource.min.js"></script>
        <script src="/static/js/libs/angular-ui-router.js"></script>
        
        <style>
            h1{
                margin-top:50px;
            }

            .orders, .order-items{
                margin-bottom:50px;
                border-bottom:solid 1px #000;
                padding:10px;
            }

            .orders table{
                width:800px;
            }

            table th{
                text-align:left;
            }

            .total span {
                display:inline-block;
                margin-left:470px;
            }

            .order-items table{
                width:600px;
            }

            input, select{
                font-size:24px;
                padding:5px;
            }

            .toolbar span{
                font-size:20px;
            }

            @media print {
                .toolbar{
                    display:none;
                }

                h1{
                    margin-top:10px;
                }
            }
        </style>
        <script>
            function getReport(){
                var d = new Date(Date.parse(document.getElementById('currentDate').value));
                var d_param = "";
                try{
                    d_param = d.getFullYear() + '-' + (d.getMonth() + 1) + '-' + d.getDate();    
                }
                catch(e){d_param = null;}
                if(d_param.indexOf('NaN') > -1) d_param = null;

                var waiter = void 0;
                try{
                    waiter = document.getElementById('waiters').selectedOptions[0];    
                }
                catch(e){}
                if(!waiter) {
                    alert("Избери персонал");
                    return ;
                }
                
            var params = '?';
            if(d_param){
                params += 'date=' + d_param + "&";
            }
            params += "w=" + waiter.id;

                window.location.href = window.location.pathname + params;
            }
        </script>
    </head>
    <body>
        <div>
            <div class="toolbar">
                <span>Избери дата: </span><input id="currentDate" type="date" />
                <span>Персонал: </span>
                <select id="waiters">
                    {% for w in waiters %}
                        <option id="{{w.id}}">{{w.first_name}}</option>
                    {% endfor %}
                </select>
                <input type="button" value="Отчет" onclick="getReport()" />
            </div>
            <h1>Отчет за деня: {{today}}</h1>
            <div class="orders">
                <h3>Поръчки за ден</h3>
                <table>
                    <tr>
                        <th>
                            Маса
                        </th>
                        <th>
                            Време на затваряне
                        </th>
                        <th>
                            Статус
                        </th>
                        <th>
                            Сметка
                        </th>
                    </tr>
                    {% for order in orders %}
                        <tr>
                            <td>
                                {{ order.table.nickname }} 
                            </td>
                            <td>
                                {{ order.closed }}
                            </td>
                            <td>
                                {% if order.status %}
                                    ПРИКЛЮЧЕНА
                                {% else %}
                                    НЕ Е ПРИКЛЮЧЕНА
                                {% endif %}
                            </td>
                            <td>
                                {{ order.total }} лв.
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                <div class="total">
                    <h3>
                        Общо оборот за деня: <span>{{total}} лв</span>
                    </h3>
                </div>
            </div>

            <div class="discount">
                <h3>
                    Общо отстъпки за деня: <span>{{discounts}} лв</span>
                </h3>
            </div>
        </div>
    </body>
</html>